<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BYOB Zero – BTC Viewer</title>

<style>
body {
  font-family: sans-serif;
  max-width: 500px;
  margin: auto;
  padding: 20px;
  text-align: center;
}

h2 { margin-bottom: 5px; }

input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin-top: 10px;
}

button {
  margin-top: 10px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

video {
  width: 100%;
  margin-top: 15px;
  border: 1px solid #ccc;
}

#result {
  margin-top: 20px;
  font-size: 16px;
  word-wrap: break-word;
}

.warning {
  font-size: 14px;
  color: red;
  margin-top: 15px;
}
</style>
</head>

<body>

<h2>BYOB Zero</h2>
<p>Bitcoin Public Address Viewer</p>

<input type="text" id="addressInput" placeholder="Enter or scan Bitcoin address">

<button onclick="checkBalance()">Check Balance</button>
<button onclick="startScanner()">Scan QR</button>

<video id="video" autoplay></video>

<div id="result"></div>

<div class="warning">
⚠ Public address only. Never enter seed words or private keys.
</div>

<script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>

<script>
let videoStream;

async function checkBalance() {
  const address = document.getElementById("addressInput").value.trim();
  const resultDiv = document.getElementById("result");

  if (!address) {
    resultDiv.innerHTML = "Please enter a Bitcoin address.";
    return;
  }

  resultDiv.innerHTML = "Checking...";

  try {
    const response = await fetch(`https://mempool.space/api/address/${address}`);
    if (!response.ok) throw new Error("Invalid address or network error");

    const data = await response.json();

    const funded = data.chain_stats.funded_txo_sum;
    const spent = data.chain_stats.spent_txo_sum;
    const balanceSats = funded - spent;
    const balanceBTC = balanceSats / 100000000;

    resultDiv.innerHTML = `
      <strong>Balance:</strong><br>
      ${balanceBTC} BTC<br><br>
      <strong>Transactions:</strong><br>
      ${data.chain_stats.tx_count}
    `;

  } catch (error) {
    resultDiv.innerHTML = "Error fetching balance.";
  }
}

async function startScanner() {
  const video = document.getElementById("video");

  try {
    videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    video.srcObject = videoStream;

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    const scan = () => {
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        canvas.height = video.videoHeight;
        canvas.width = video.videoWidth;
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height);

        if (code) {
          document.getElementById("addressInput").value = code.data;
          videoStream.getTracks().forEach(track => track.stop());
          video.remove();
          return;
        }
      }
      requestAnimationFrame(scan);
    };

    scan();

  } catch (err) {
    alert("Camera access denied or not available.");
  }
}
</script>

</body>
</html>
